<!DOCTYPE html>
<html>
<head>
    <title>Location Analyzer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input[type="file"], input[type="date"], input[type="password"], input[type="text"] {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;
            font-size: 14px;
        }
        input[type="file"]:focus, input[type="date"]:focus, input[type="password"]:focus, input[type="text"]:focus {
            border-color: #007bff; outline: none; box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        button { 
            background: #007bff; color: white; padding: 12px 24px; border: none; 
            border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%;
            transition: background 0.3s;
        }
        button:hover:not(:disabled) { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .btn-secondary {
            background: #6c757d; margin-top: 10px; padding: 8px 16px; font-size: 14px;
        }
        .btn-secondary:hover { background: #545b62; }
        .alert { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .instructions { background: #e9ecef; padding: 20px; border-radius: 4px; margin-top: 30px; }
        .instructions h3 { margin-top: 0; color: #495057; }
        .instructions ol { padding-left: 20px; }
        .instructions a { color: #007bff; text-decoration: none; }
        .instructions a:hover { text-decoration: underline; }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        .config-info { background: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 4px; margin-bottom: 20px; font-size: 14px; }
        .saved-indicator { color: #28a745; font-size: 12px; margin-left: 5px; }
        small { color: #6c757d; display: block; margin-top: 5px; }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Location Analyzer</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% if default_geoapify_key or default_google_key %}
        <div class="config-info">
            ‚ÑπÔ∏è <strong>Settings Loaded:</strong> Your API keys and previous date selections have been restored.
            <form method="POST" action="{{ url_for('clear_config') }}" style="display: inline; margin-left: 10px;">
                <button type="submit" class="btn-secondary" onclick="return confirm('Clear all saved settings?')">
                    Clear Settings
                </button>
            </form>
        </div>
        {% endif %}
        
        {% if not analyzer_available %}
            <div class="alert alert-error">
                <strong>‚ö†Ô∏è Analyzer not available.</strong> Please check setup and ensure all dependencies are installed.
            </div>
        {% endif %}
        
        <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" id="uploadForm">
            <div class="form-group">
                <label for="file">üìÅ Google Location History JSON:</label>
                <input type="file" name="file" id="file" accept=".json" required>
                <small>Select your exported Google Location History file</small>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">üìÖ Start Date:</label>
                    <input type="date" name="start_date" id="start_date" value="{{ default_start_date }}" required>
                    {% if default_start_date != "2024-01-01" %}<span class="saved-indicator">‚úì saved</span>{% endif %}
                </div>
                
                <div class="form-group">
                    <label for="end_date">üìÖ End Date:</label>
                    <input type="date" name="end_date" id="end_date" value="{{ default_end_date }}" required>
                    {% if default_end_date != today %}<span class="saved-indicator">‚úì saved</span>{% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="geoapify_key">üîë Geoapify API Key (Required):</label>
                <input type="{% if default_geoapify_key %}text{% else %}password{% endif %}" 
                       name="geoapify_key" id="geoapify_key" 
                       value="{{ default_geoapify_key }}"
                       placeholder="Enter your Geoapify API key" required>
                {% if default_geoapify_key %}<span class="saved-indicator">‚úì saved</span>{% endif %}
                <small>
                    Get a free key from <a href="https://www.geoapify.com/" target="_blank">geoapify.com</a>
                    (3,000 requests/day free)
                </small>
            </div>
            
            <div class="form-group">
                <label for="google_key">üîë Google Maps API Key (Optional):</label>
                <input type="{% if default_google_key %}text{% else %}password{% endif %}" 
                       name="google_key" id="google_key" 
                       value="{{ default_google_key }}"
                       placeholder="Enter your Google Maps API key (optional)">
                {% if default_google_key %}<span class="saved-indicator">‚úì saved</span>{% endif %}
                <small>Optional fallback for geocoding when Geoapify limits are reached</small>
            </div>
            
            <button type="submit" {{ 'disabled' if not analyzer_available }} id="submitBtn">
                üöÄ Start Analysis
            </button>
        </form>
        
        <div class="instructions">
            <h3>üìã How to Use:</h3>
            <ol>
                <li>Export your Google Location History from <a href="https://takeout.google.com" target="_blank">Google Takeout</a></li>
                <li>Get a free API key from <a href="https://www.geoapify.com/" target="_blank">Geoapify</a></li>
                <li>Upload your JSON file and enter your API key above</li>
                <li>Select your desired date range</li>
                <li>Click "Start Analysis" and wait for results</li>
            </ol>
            
            <p><strong>üí° Note:</strong> Your API keys and date selections are automatically saved for convenience. Large files may take 5-15 minutes to process.</p>
        </div>
    </div>

    <script>
        // Show processing feedback
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = '‚è≥ Processing...';
            btn.disabled = true;
        });
        
        // File selection feedback
        document.getElementById('file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const size = (file.size / 1024 / 1024).toFixed(1);
                console.log(`File selected: ${file.name} (${size} MB)`);
            }
        });
        
        // Toggle password visibility for API keys
        document.getElementById('geoapify_key').addEventListener('dblclick', function() {
            this.type = this.type === 'password' ? 'text' : 'password';
        });
        
        document.getElementById('google_key').addEventListener('dblclick', function() {
            this.type = this.type === 'password' ? 'text' : 'password';
        });
    </script>
</body>
</html>